# peer_service

client_service와 함께 분산 처리를 완결한다. 

관계가 많이 생긴다. 
- 로컬 액터와 리모트 액터의 up / down 사용 인터페이스
- 피어의 down 시 리모트 액터 down 처리 

## use case 

리모트 액터를 쉽게 사용하도록 하는 것이 핵심 기능이다. 
리모트 액터가 로컬로 옮겨오더라도 동일한 코드로 동작해야 한다. 
이것이 관건이다. 

## 단계적 구현 

- 구성 파일 읽기 
- listen 
- connect
- 핸들러 등록 
- 핸들러 구현 
- 필요한 데이터 추가 
- syn_peer_up / syn_peer_down 메세지 추가 


## connect / accept / reconnect / disconnect

- reconnect 

## peer

연결을 피어로 만든다. 프로토콜만 기억한다. 

accept 받은 쪽에서 syn_peer_up을 보낸다. 이에 대한 답으로 syn_peer_up을 보낸다. 
accepted 에서 오는 syn_peer_up은 응답을 보내지 않는다. 

up까지 받으면 준비된 것이다. 

## 단선 처리 

단선 처리를 잘 되려면 액터들 up / down과 사용 구조가 있어야 한다. 
액터 up / down과 리모트 / 클라이언트 액터 사용을 고민해 본다. 

어떻게 찾아서 사용할 지, 어떻게 알 지가 중요하고 또 끊어지거나 내려가면 알 수 있어야 한다. 

## 디버깅 1 

중간 중간 단단하게 하면서 앞으로 간다. 

### 메인 쓰레드 스케줄링 

test_peer_service의 기본 실행에서 main 쓰레드가 매우 오래 지속되는 문제가 있다. 코드 구조로 보면 
1초 이내에 종료해야 하는데 그렇지 않다. 

### actor_directory 종료 

~server 부터 소멸자 처리에서 예외가 발생했다. tcp_protocol 내부. 









